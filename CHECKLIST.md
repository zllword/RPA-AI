# 生产环境部署检查清单

## 🔒 安全检查

### 必须完成
- [ ] 配置 .env 文件（使用真实API密钥）
- [ ] 设置文件权限：`chmod 600 .env`
- [ ] 确保 .env 在 .gitignore 中
- [ ] 检查 config.json 不包含真实密钥
- [ ] 数据库文件权限设置正确
- [ ] 日志文件不包含敏感信息

### 推荐完成
- [ ] 启用防火墙规则
- [ ] 配置 fail2ban（如果暴露在公网）
- [ ] 使用 HTTPS（Web界面）
- [ ] 定期备份数据库

---

## ⚙️ 配置检查

### 基础配置
- [ ] API密钥已配置且有效
- [ ] 微信PC客户端已登录
- [ ] Tesseract OCR 已安装
- [ ] Python 版本 >= 3.8

### 运行参数
- [ ] reply_delay_min >= 2（避免检测）
- [ ] reply_delay_max <= 10
- [ ] max_daily_replies <= 100
- [ ] 白名单模式启用（推荐）

### 日志配置
- [ ] 日志级别设置（生产环境建议 WARNING）
- [ ] 日志轮转已配置
- [ ] 日志文件存储位置确定

---

## 🚀 部署检查

### 依赖安装
- [ ] Python 依赖已安装：`pip install -r requirements.txt`
- [ ] Tesseract OCR 已安装
- [ ] 系统依赖完整

### 目录结构
- [ ] logs/ 目录已创建
- [ ] screenshots/ 目录已创建
- [ ] data/ 目录已创建
- [ ] backups/ 目录已创建

### 进程管理
- [ ] 配置 systemd 服务（Linux）
- [ ] 或配置 supervisor（跨平台）
- [ ] 或配置启动脚本

### 监控告警
- [ ] 配置进程监控（monit/systemd）
- [ ] 配置日志监控（fail2ban）
- [ ] 配置错误告警（邮件/webhook）

---

## 🧪 测试检查

### 功能测试
- [ ] 测试模式运行正常：`python3 core/bot.py test`
- [ ] AI回复功能正常
- [ ] 消息记录正常保存
- [ ] Web界面可访问

### 压力测试
- [ ] 连续运行1小时无崩溃
- [ ] 处理100条消息无错误
- [ ] 内存使用稳定（无泄漏）
- [ ] 数据库连接正常

### 回滚测试
- [ ] 有备份恢复方案
- [ ] 测试回滚流程
- [ ] 数据可迁移

---

## 📊 性能检查

### 资源使用
- [ ] CPU使用率 < 50%（正常情况）
- [ ] 内存使用 < 500MB
- [ ] 磁盘IO正常
- [ ] 网络带宽充足

### 响应时间
- [ ] AI响应时间 < 5秒
- [ ] 消息检测延迟 < 2秒
- [ ] OCR识别准确率 > 80%

---

## 🔧 维护检查

### 日常维护
- [ ] 设置数据库定期备份（每日）
- [ ] 设置日志定期清理（每周）
- [ ] 设置截图定期清理（每月）
- [ ] 监控磁盘空间使用

### 应急预案
- [ ] 准备重启脚本
- [ ] 准备降级方案
- [ ] 准备联系方式
- [ ] 文档已更新

---

## ⚠️ 风险提示

### 已知风险
1. **微信账号风险**
   - 可能被限制使用
   - 可能被临时封禁
   - 建议使用小号

2. **技术风险**
   - OCR识别可能不准确
   - AI回复可能不恰当
   - 程序可能意外崩溃

3. **数据风险**
   - 数据库可能损坏
   - 消息记录可能丢失
   - 需要定期备份

### 减缓措施
- ✅ 使用白名单模式
- ✅ 限制每日回复数量
- ✅ 设置合理回复延迟
- ✅ 定期备份数据
- ✅ 监控运行状态
- ✅ 准备应急方案

---

## ✅ 部署前最终确认

- [ ] 所有安全检查项完成
- [ ] 所有配置检查项完成
- [ ] 所有测试检查项完成
- [ ] 所有维护计划已制定
- [ ] 团队已培训
- [ ] 文档已更新
- [ ] 备份策略已实施

---

**部署人员签字**: _________________  **日期**: _________

**审核人员签字**: _________________  **日期**: _________
